# ADR-004: Testing Framework

## Context and Problem Statement
Our browser extension project, developed with a vanilla JavaScript tech stack, requires a robust testing framework to ensure code quality and reliable functionality. The testing framework must support unit and end-to-end (E2E) testing, handle browser-specific features like extensions, and integrate well with our CI/CD pipeline. We need a solution that allows for efficient, comprehensive testing across multiple browsers and can be easily managed by the development team.

## Decision Drivers
1. **Browser Extension Support**: The framework must be capable of testing browser-specific features, such as content scripts and popups, which are core to our extension.
2. **Cross-Browser Testing**: The extension should function reliably across major browsers, including Chrome, Firefox, and Edge.
3. **Unified Testing Environment**: A single framework for unit and E2E testing would simplify the development workflow, reduce the learning curve, and streamline CI/CD integration.
4. **Modern Development Practices**: We want to leverage modern JavaScript features, such as async/await, to make test code clean and maintainable.
5. **Ease of Use and Efficiency**: The framework should be developer-friendly, have useful built-in tools, and minimize the need for extensive configuration.

## Considered Options
### 1. **Playwright (Chosen Framework)**
   - **Pros**:
     - **Built-in Support for Browser Extensions**: Playwright has native capabilities to test browser extensions, making it a strong choice for our project.
     - **Cross-Browser Testing**: Supports testing on Chrome, Firefox, and Edge, ensuring our extension is robust across different platforms.
     - **Browser Context Isolation**: Allows for isolated browser contexts, making tests more reliable and parallelizable.
     - **Unified Testing Framework**: Can handle both unit and E2E tests within a single environment.
     - **Modern Async/Await Syntax**: Simplifies writing and managing asynchronous tests, making the code more readable.
     - **Efficient CI/CD Integration**: One command can run all tests and shared test utilities simplify CI/CD setup and maintenance.
     - **Powerful Debugging Tools**: Built-in browser APIs and debugging utilities improve the developer experience.
   - **Cons**:
     - **Learning Curve**: Playwright’s API can be complex for developers unfamiliar with browser automation or asynchronous testing.
     - **Resource Intensive**: Running tests across multiple browsers may require more computational resources.

### 2. **Mocha + Chai (Unit Testing Only)**
   - **Pros**:
     - **Highly Flexible**: Offers extensive customization for test setup and assertion styles.
     - **Well-Suited for Unit Tests**: Reliable and widely used for JavaScript unit testing.
   - **Cons**:
     - **Limited to Unit Testing**: Cannot handle E2E tests, necessitating another framework for full coverage.
     - **More Setup Required**: It needs more configuration than frameworks like Jest or Playwright.

### 3. **Jest (Unit Testing Only)**
   - **Pros**:
     - **Zero Configuration**: Simplifies setup for vanilla JS projects.
     - **Built-In Mocking**: Provides robust tools for mocking browser APIs and DOM elements.
     - **Snapshot Testing**: Useful for ensuring UI consistency.
   - **Cons**:
     - **Not Ideal for E2E Testing**: Requires additional frameworks for comprehensive browser automation.
     - **Potential Compatibility Issues**: Limited support for complex browser extension scenarios compared to Playwright.

### 4. **Cypress (E2E Testing Only)**
   - **Pros**:
     - **Easy Setup**: Known for simple installation and configuration.
     - **Rich Developer Experience**: Provides an excellent GUI for debugging tests.
   - **Cons**:
     - **Limited Browser Support**: Does not support Firefox and Edge as robustly as Playwright.
     - **Weak Extension Testing**: Lacks built-in support for browser extension testing, making it unsuitable for our needs.

## Decision
We have chosen **Playwright** as our testing framework. Playwright's capabilities align well with the requirements of our browser extension project, providing a single, cohesive testing environment that handles both unit and E2E tests. The framework's built-in support for browser extension testing, cross-browser compatibility, and modern features make it an ideal choice. The benefits of using a unified framework far outweigh the learning curve and potential resource demands.

## Consequences
### Positive Consequences
- **Unified Testing Workflow**: Developers only need to learn one framework, simplifying the onboarding process and reducing context-switching between tools.
- **Efficient CI/CD Integration**: With Playwright, all tests can be run using a single command, improving efficiency and consistency in automated testing.
- **Cross-Browser Reliability**: Ensures our extension performs well across Chrome, Firefox, and Edge, enhancing its robustness and user experience.
- **Simplified Debugging and Reporting**: Playwright’s built-in tools make debugging issues and analyzing test reports easier.

### Negative Consequences
- **Resource Consumption**: Running comprehensive cross-browser tests can be demanding and require adequate computational resources in CI/CD environments.
- **Initial Learning Curve**: Developers may need time to become familiar with Playwright’s API and browser automation concepts.

### Trade-Offs
- **Simplicity vs. Power**: We opted for a more powerful but slightly complex framework (Playwright) to achieve full testing coverage rather than simpler frameworks limited to unit or E2E testing.
- **Resource Use vs. Test Coverage**: We prioritized comprehensive test coverage over minimal resource use, understanding that adequate infrastructure will be necessary to run our tests efficiently.

## Related Architectural Decisions
- **Branching Strategy**: Our choice of a unified testing framework complements our `main`-`feature/fix` branching strategy, facilitating straightforward CI/CD integration.

## Notes and Future Considerations
- **Optimizing Test Runs**: We may need to explore parallel test execution or selective test runs to optimize performance in our CI/CD pipeline.
- **Continuous Learning**: As the team becomes more familiar with Playwright, we may find ways to streamline our tests further and improve reliability.
- **Future Framework Expansion**: If our testing needs evolve, we can consider integrating additional frameworks or tools for specialized testing scenarios.

This decision ensures our browser extension project is tested efficiently and comprehensively, laying the groundwork for a reliable and maintainable codebase.
